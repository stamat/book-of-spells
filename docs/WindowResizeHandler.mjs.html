<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WindowResizeHandler.mjs - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-WindowResizeHandler-WindowResizeHandler.html">WindowResizeHandler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler-WindowResizeHandler.html#_triggerCallback">_triggerCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler-WindowResizeHandler.html#add">add</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler-WindowResizeHandler.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler-WindowResizeHandler.html#destroy">destroy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler-WindowResizeHandler.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler-WindowResizeHandler.html#run">run</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler-WindowResizeHandler.html#trigger">trigger</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-WindowResizeHandler.html">WindowResizeHandler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler.html#~inRange">inRange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler.html#~parseMediaQueryString">parseMediaQueryString</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler.html#~validateMediaQuery">validateMediaQuery</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-WindowResizeHandler.html#~validateMediaQueryEntry">validateMediaQueryEntry</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-browser.html">browser</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-browser.html#.isIOS">isIOS</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-browser.html#.isIOSSafari">isIOSSafari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-browser.html#.isMobile">isMobile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-browser.html#.isSafari">isSafari</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-cookies.html">cookies</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-cookies.html#.cookieExpirationDate">cookieExpirationDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-cookies.html#.deleteCookie">deleteCookie</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-cookies.html#.getCookie">getCookie</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-cookies.html#.hasCookie">hasCookie</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-cookies.html#.setCookie">setCookie</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-cookies.html#.updateCookie">updateCookie</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-dom.html">dom</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.css">css</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.cssTimeToMilliseconds">cssTimeToMilliseconds</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.decodeHTML">decodeHTML</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.detachElement">detachElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.getTableData">getTableData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.getTransitionDurations">getTransitionDurations</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.insertBeforeElement">insertBeforeElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.isEmptyElement">isEmptyElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.matchesAll">matchesAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.matchesAny">matchesAny</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.query">query</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.querySingle">querySingle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-dom.html#.toggleAttributeValue">toggleAttributeValue</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-parsers.html">parsers</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-parsers.html#.parseAttributes">parseAttributes</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-slide.html">slide</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-slide.html#.slideDown">slideDown</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-slide.html#.slideToggle">slideToggle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-slide.html#.slideUp">slideUp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-slide.html#~clearSlideTimer">clearSlideTimer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-slide.html#~setSlideDuration">setSlideDuration</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#clone">clone</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#deepMerge">deepMerge</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#hasOwnProperties">hasOwnProperties</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isArray">isArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isEmpty">isEmpty</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isEmptyArray">isEmptyArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isEmptyObject">isEmptyObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isFunction">isFunction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isObject">isObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isString">isString</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mapByProperty">mapByProperty</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mapPropertyToProperty">mapPropertyToProperty</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#propertyIsFunction">propertyIsFunction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#propertyIsString">propertyIsString</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeAccents">removeAccents</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#shallowMerge">shallowMerge</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#slugify">slugify</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#stringToArray">stringToArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#stringToBoolean">stringToBoolean</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#stringToNumber">stringToNumber</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#stringToObject">stringToObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#stringToPrimitive">stringToPrimitive</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#stringToRegex">stringToRegex</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#stringToType">stringToType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#stripHTMLTags">stripHTMLTags</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#transformDashToCamelCase">transformDashToCamelCase</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">WindowResizeHandler.mjs</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module WindowResizeHandler */

/**
 * Parse a media query string into a query array. Query arrays contain query entry objects {@link QueryEntryObject} and strings for the operators 'and' and 'or'.
 * 
 * @private
 * @param mediaQuery - A media query string. Example: "(min-width: 768px) and (max-width: 1024px)"
 * @returns Array&lt;string | QueryEntryObject>
 * @example
 * const query = this._parseMediaQueryString('(min-width: 768px) and (max-width: 1024px)')
 * console.log(query) // [{ value: 768, feature: 'width', direction: 'min' }, 'and', { value: 1024, feature: 'width', direction: 'max' }]
 */
function parseMediaQueryString(mediaQuery) {
  const trimmedQuery = mediaQuery.trim().replace(/\(|\)/g, '')
  const clauses = trimmedQuery.split(/(\s+and\s+|\s+or\s+)/i)
  const query = []

  clauses.forEach((clause) => {
    clause = clause.trim().toLowerCase()

    if (!/:/.test(clause)) {
      query.push(clause)
      return
    }

    const [rawFeature, rawValue] = clause.split(/\s*:\s*/)
    const fullFeature = rawFeature.trim().toLowerCase()
    const feature = /height$/.test(fullFeature) ? 'height' : 'width'
    const direction = /^max/.test(fullFeature) ? 'max' : 'min'
    const value = parseInt(rawValue.trim())

    query.push({
      value: value,
      feature: feature,
      direction: direction,
    })
  })
  return query
}

/**
 * Perform a single query entry condition check. You can use this to check if the window width or height is within a certain range by providing a query entry object {@link QueryEntryObject}
 * Meaning, you can check if the window width is greater than or equal to 768px, or if the window height is less than or equal to 1024px.
 * 
 * @private
 * @param queryEntry - A single query entry object
 * @returns boolean
 * @example
 * const queryEntry = {
 *  value: 768,
 *  feature: 'width',
 *  direction: 'min'
 * }
 *
 * const result = validateMediaQueryEntry(queryEntry)
 * console.log(result) // true if window width is greater than or equal to 768px
 */
function validateMediaQueryEntry(queryEntry) {
  const { value, feature, direction } = queryEntry
  const windowValue = feature === 'width' ? window.innerWidth : window.innerHeight
  return direction === 'min' ?  value &lt;= windowValue : value >= windowValue
}

/**
 * Perform a query. You can use this to check if the window width or height is within a certain range by providing a query array.
 * Query arrays are parsed from media query strings using {@link _parseMediaQueryString} and contain query entry objects {@link QueryEntryObject} and strings for the operators 'and' and 'or'.
 * 
 * @private
 * @param query - A query array
 * @returns boolean
 * @example
 * const query = [{
 *  value: 768,
 *  feature: 'width',
 *  direction: 'min'
 * },
 * 'or',
 * {
 *  value: 1024,
 *  feature: 'width',
 *  direction: 'max'
 * }]
 * 
 * const result = validateMediaQuery(query)
 * console.log(result) // true if window width is greater than or equal to 768px or less than or equal to 1024px
 */
function validateMediaQuery(query) {
  if (query.hasOwnProperty('matches')) return query.matches
  
  let result = true
  let operator = 'and'

  for (let i = 0; i &lt; query.length; i++) {
    const entry = query[i]
    if (typeof entry === 'string') {
      operator = entry
      continue
    }

    const entryResult = validateMediaQueryEntry(entry)

    if (operator === 'and') {
      result = result &amp;&amp; entryResult
    } else {
      result = result || entryResult
    }
  }

  return result
}

/**
 * Check if the window width or height is within a certain range by providing a media query string.
 * 
 * @param mediaQuery - A media query string or already parsed query array. Example: "(min-width: 768px) and (max-width: 1024px)"
 * @returns boolean
 * @example
 * const result = inRange('(min-width: 768px) and (max-width: 1024px)')
 * console.log(result) // true if window width is greater than or equal to 768px and less than or equal to 1024px
 */
function inRange(mediaQuery) {
  if (typeof mediaQuery === 'string') mediaQuery = 'matchMedia' in window ? matchMedia(mediaQuery) : parseMediaQueryString(mediaQuery)
  return validateMediaQuery(mediaQuery)
}

/**
 * A class for handling window resize events. 
 * Provides a way to add callbacks to be triggered when the window is resized to match a media query.
 * 
 * @example
 * const resizeHandler = new WindowResizeHandler()
 * resizeHandler.add('(min-width: 768px) and (max-width: 1024px)', () => {
 *  console.log('Between 768px and 1024px')
 * })
 */
class WindowResizeHandler {
  constructor(opts) {
    opts = opts || {}
    this._resizeCallbacks = {}
    this._resizeTimeout = 0
    this._resizeTimeoutDuration = opts.timeoutDuration || 100
    this._oldWidth = window.innerWidth
    this._oldHeight = window.innerHeight
    this._observeWidth = opts.observeHeight || true
    this._observeHeight = opts.observeHeight || true

    /**
     * Trigger a callback for a given media query string. Callbacks are bucketed by media query string.
     * Callbacks are triggered when the window is resized to match the media query or when the window is resized out of the media query range.
     * The callback is passed a boolean value that indicates if the window is currently within the media query range or not, so you can use the callback to trigger something when the window is resized out of the media query range.
     * 
     * @private
     * @param {string} query - A media query string. Example: "(min-width: 768px) and (max-width: 1024px)"
     * @returns void
     */
    this._triggerCallback = (query) => {
      for (const rc of this._resizeCallbacks[query]) {
        const { mediaArray, callback } = rc
        const inRange = validateMediaQuery(mediaArray)


        //TODO: This has no logic for when the once is not used, we should start from two cases - inRange and not inRange callbacks. This needs to be rethought...
        // not in range
        if (rc.once &amp;&amp; (rc.performed === undefined || rc.performed) &amp;&amp; !inRange) {
          rc.performed = false
          callback(false)
        }
        
        // already performed, skip
        if (rc.once &amp;&amp; rc.performed) continue

        // in range
        if (inRange) {
          callback(true)
          rc.performed = true
        }
      }
    }

    this._propertyChangeHandler = () => {
      let run = false

      if (this._observeWidth &amp;&amp; this._oldWidth !== window.innerWidth) {
        this._oldWidth = window.innerWidth
        run = true
      }

      if (this._observeHeight &amp;&amp; this._oldHeight !== window.innerHeight) {
        this._oldHeight = window.innerHeight
        run = true
      }

      if (run) this.run()
    }

    this._resizeHandler = () => {
      if (this._resizeTimeout) {
        clearTimeout(this._resizeTimeout);
      }

      this._resizeTimeout = setTimeout(() => {
        this._resizeTimeout = 0;
        this._propertyChangeHandler()
      }, this._resizeTimeoutDuration);
    }
    window.addEventListener("resize", this._resizeHandler);
  }

  /**
   * Add a callback to be triggered when the window is resized to match the media query. Callbacks are bucketed by media query string.
   * Callbacks are triggered when the window is resized to match the media query or when the window is resized out of the media query range.
   * The callback is passed a boolean value that indicates if the window is currently within the media query range or not, so you can use the callback to trigger something when the window is resized out of the media query range.
   * 
   * @param query - A media query string. Example: "(min-width: 768px) and (max-width: 1024px)" 
   * @param callback
   * @param {boolean} [once=true] - If true, the callback will only be triggered once when the media query is matched. Defaults to true.
   * @returns void
   */
  add(query, callback, once = true) {
    let mediaArray = []

    if (!this._resizeCallbacks.hasOwnProperty(query)) {
      this._resizeCallbacks[query] = []
      mediaArray = parseMediaQueryString(query)
    }

    if (this._resizeCallbacks[query].length) {
      mediaArray = this._resizeCallbacks[query][0].mediaArray
    } else {
      mediaArray = parseMediaQueryString(query)
    }

    this._resizeCallbacks[query].push({
      query: query,
      mediaArray: mediaArray,
      callback: callback,
      once: once,
    })
  }

  /**
   * Trigger a callback manually. All callbacks for the given media query will be triggered.
   * 
   * @param {string} query - A media query string. Example: "(min-width: 768px) and (max-width: 1024px)"
   * @returns void
   */
  trigger(query) {
    if (!this._resizeCallbacks.hasOwnProperty(query)) return

    for (const rc of this._resizeCallbacks[query]) {
      const { callback } = rc
      callback(true)
    }
  }

  /**
   * Remove a callback from the resize handler. You have to provide the same callback function reference that was used when adding the callback.
   * 
   * @param {string} query - A media query string. Example: "(min-width: 768px) and (max-width: 1024px)"
   * @param {function} [callback] - The callback to remove from the resize handler for the given media query
   * @returns void
   */
  remove(query, callback) {
    if (!this._resizeCallbacks.hasOwnProperty(query)) return
    if (!callback) {
      delete this._resizeCallbacks[query]
      return
    }

    for (let i = 0; i &lt; this._resizeCallbacks[query].length; i++) {
      const rc = this._resizeCallbacks[query][i]
      if (rc.callback === callback) {
        this._resizeCallbacks[query].splice(i, 1)
      }
    }
  }

  /**
   * Run all callbacks that match the current window size parameters. This is useful if you want to trigger all callbacks when the page loads.
   *  
   * @returns void
   */
  run() {
    for (const key in this._resizeCallbacks) {
      this._triggerCallback(key)
    }
  }

  /**
   * Destroy the resize handler
   * 
   * @returns void
   */
  destroy() {
    window.removeEventListener("resize", this._resizeHandler);
  }

  /**
   * Rebind the resize handler. This is useful if you want to rebind the resize handler after destroying it.
   * 
   * @returns void
   */
  bind() {
    window.addEventListener("resize", this._resizeHandler);
  }
}

export default WindowResizeHandler
export { WindowResizeHandler, inRange, parseMediaQueryString, validateMediaQueryEntry, validateMediaQuery }
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Wed Jul 26 2023 18:46:35 GMT+0200 (Central European Summer Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
